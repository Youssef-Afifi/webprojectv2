const sqlite3 = require('sqlite3');
const db = new sqlite3.Database('laptops.db'); 

const createUserTable = `
CREATE TABLE IF NOT EXISTS USERS (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NAME TEXT NOT NULL,
    EMAIL TEXT UNIQUE NOT NULL,
    PASSWORD TEXT NOT NULL,
    ROLE TEXT DEFAULT 'user'
);`;

const createProductTable = `
CREATE TABLE IF NOT EXISTS PRODUCT (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NAME TEXT NOT NULL,
    DESCRIPTION TEXT,
    PRICE REAL NOT NULL,
    QUANTITY INTEGER NOT NULL
);`;

const createCartTable = `
CREATE TABLE IF NOT EXISTS CART (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INTEGER NOT NULL,
    PRODUCT_ID INTEGER NOT NULL,
    QUANTITY INTEGER NOT NULL,
    FOREIGN KEY(USER_ID) REFERENCES USERS(ID),
    FOREIGN KEY(PRODUCT_ID) REFERENCES PRODUCT(ID)
);`;

const createOrdersTable = `
CREATE TABLE IF NOT EXISTS ORDERS (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INTEGER NOT NULL,
    PRODUCT_ID INTEGER NOT NULL,
    QUANTITY INTEGER NOT NULL,
    TOTAL_PRICE REAL NOT NULL,
    NAME TEXT NOT NULL,
    ADDRESS TEXT NOT NULL,
    PAYMENT_METHOD TEXT NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY(USER_ID) REFERENCES USERS(ID),
    FOREIGN KEY(PRODUCT_ID) REFERENCES PRODUCT(ID)
);`;

db.serialize(() => {
    db.run(createUserTable);
    db.run(createProductTable);
    db.run(createCartTable);
    db.run(createOrdersTable);
});

module.exports = { db };
